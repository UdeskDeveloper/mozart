!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){function f(a){e(function(){var b,c;for(b=0;b<a.length;b++)c=a[b],c.obj.css(c.css)})}function g(b){return a.trim(b).toLowerCase()}var b,c,d;d=function(a,b){return function(){return a.apply(b,arguments)}},c={align:"center",autoResize:!1,comparator:null,container:a("body"),ignoreInactiveItems:!0,itemWidth:0,fillEmptySpace:!1,flexibleWidth:0,direction:void 0,offset:2,onLayoutChanged:void 0,outerOffset:0,resizeDelay:50,possibleFilters:[]};var e=window.requestAnimationFrame||function(a){a()};b=function(){function b(b,e){this.handler=b,this.columns=this.containerWidth=this.resizeTimer=null,this.activeItemCount=0,this.itemHeightsDirty=!0,this.placeholders=[],a.extend(!0,this,c,e),this.update=d(this.update,this),this.onResize=d(this.onResize,this),this.onRefresh=d(this.onRefresh,this),this.getItemWidth=d(this.getItemWidth,this),this.layout=d(this.layout,this),this.layoutFull=d(this.layoutFull,this),this.layoutColumns=d(this.layoutColumns,this),this.filter=d(this.filter,this),this.clear=d(this.clear,this),this.getActiveItems=d(this.getActiveItems,this),this.refreshPlaceholders=d(this.refreshPlaceholders,this),this.sortElements=d(this.sortElements,this),this.updateFilterClasses=d(this.updateFilterClasses,this),this.updateFilterClasses(),this.autoResize&&a(window).bind("resize.wookmark",this.onResize),this.container.bind("refreshWookmark",this.onRefresh)}return b.prototype.updateFilterClasses=function(){for(var e,f,h,j,a=0,b=0,c=0,d={},i=this.possibleFilters;a<this.handler.length;a++)if(f=this.handler.eq(a),e=f.data("filterClass"),"object"==typeof e&&e.length>0)for(b=0;b<e.length;b++)h=g(e[b]),d[h]||(d[h]=[]),d[h].push(f[0]);for(;c<i.length;c++)j=g(i[c]),j in d||(d[j]=[]);this.filterClasses=d},b.prototype.update=function(b){this.itemHeightsDirty=!0,a.extend(!0,this,b)},b.prototype.onResize=function(){clearTimeout(this.resizeTimer),this.itemHeightsDirty=0!==this.flexibleWidth,this.resizeTimer=setTimeout(this.layout,this.resizeDelay)},b.prototype.onRefresh=function(){this.itemHeightsDirty=!0,this.layout()},b.prototype.filter=function(b,c){var e,h,i,j,k,d=[],f=a();if(b=b||[],c=c||"or",b.length){for(h=0;h<b.length;h++)k=g(b[h]),k in this.filterClasses&&d.push(this.filterClasses[k]);if(e=d.length,"or"==c||1==e)for(h=0;e>h;h++)f=f.add(d[h]);else if("and"==c){var n,o,p,l=d[0],m=!0;for(h=1;e>h;h++)d[h].length<l.length&&(l=d[h]);for(l=l||[],h=0;h<l.length;h++){for(o=l[h],m=!0,i=0;i<d.length&&m;i++)if(p=d[i],l!=p){for(j=0,n=!1;j<p.length&&!n;j++)n=p[j]==o;m&=n}m&&f.push(l[h])}}this.handler.not(f).addClass("inactive")}else f=this.handler;f.removeClass("inactive"),this.columns=null,this.layout()},b.prototype.refreshPlaceholders=function(b,c){for(var e,f,h,i,j,k,d=this.placeholders.length,g=this.columns.length,l=this.container.innerHeight();g>d;d++)e=a('<div class="wookmark-placeholder"/>').appendTo(this.container),this.placeholders.push(e);for(k=this.offset+2*parseInt(this.placeholders[0].css("borderLeftWidth"),10),d=0;d<this.placeholders.length;d++)if(e=this.placeholders[d],h=this.columns[d],d>=g||!h[h.length-1])e.css("display","none");else{if(f=h[h.length-1],!f)continue;j=f.data("wookmark-top")+f.data("wookmark-height")+this.offset,i=l-j-k,e.css({position:"absolute",display:i>0?"block":"none",left:d*b+c,top:j,width:b-k,height:i})}},b.prototype.getActiveItems=function(){return this.ignoreInactiveItems?this.handler.not(".inactive"):this.handler},b.prototype.getItemWidth=function(){var a=this.itemWidth,b=this.container.width()-2*this.outerOffset,c=this.handler.eq(0),d=this.flexibleWidth;if(void 0===this.itemWidth||0===this.itemWidth&&!this.flexibleWidth?a=c.outerWidth():"string"==typeof this.itemWidth&&this.itemWidth.indexOf("%")>=0&&(a=parseFloat(this.itemWidth)/100*b),d){"string"==typeof d&&d.indexOf("%")>=0&&(d=parseFloat(d)/100*b);var e=~~(.5+(b+this.offset)/(d+this.offset)),f=Math.min(d,~~((b-(e-1)*this.offset)/e));a=Math.max(a,f),this.handler.css("width",a)}return a},b.prototype.layout=function(a){if(this.container.is(":visible")){var k,b=this.getItemWidth()+this.offset,c=this.container.width(),d=c-2*this.outerOffset,e=~~((d+this.offset)/b),f=0,g=0,h=0,i=this.getActiveItems(),j=i.length;if(this.itemHeightsDirty||!this.container.data("itemHeightsInitialized")){for(;j>h;h++)k=i.eq(h),k.data("wookmark-height",k.outerHeight());this.itemHeightsDirty=!1,this.container.data("itemHeightsInitialized",!0)}e=Math.max(1,Math.min(e,j)),f=this.outerOffset,"center"==this.align&&(f+=~~(.5+(d-(e*b-this.offset))>>1)),this.direction=this.direction||("right"==this.align?"right":"left"),g=a||null===this.columns||this.columns.length!=e||this.activeItemCount!=j?this.layoutFull(b,e,f):this.layoutColumns(b,f),this.activeItemCount=j,this.container.css("height",g),this.fillEmptySpace&&this.refreshPlaceholders(b,f),void 0!==this.onLayoutChanged&&"function"==typeof this.onLayoutChanged&&this.onLayoutChanged()}},b.prototype.sortElements=function(a){return"function"==typeof this.comparator?a.sort(this.comparator):a},b.prototype.layoutFull=function(b,c,d){var e,m,g=0,h=0,i=a.makeArray(this.getActiveItems()),j=i.length,k=null,l=null,n=[],o=[],p="left"==this.align?!0:!1;for(this.columns=[],i=this.sortElements(i);n.length<c;)n.push(this.outerOffset),this.columns.push([]);for(;j>g;g++){for(e=a(i[g]),k=n[0],l=0,h=0;c>h;h++)n[h]<k&&(k=n[h],l=h);e.data("wookmark-top",k),m=d,(l>0||!p)&&(m+=l*b),(o[g]={obj:e,css:{position:"absolute",top:k}}).css[this.direction]=m,n[l]+=e.data("wookmark-height")+this.offset,this.columns[l].push(e)}return f(o),Math.max.apply(Math,n)},b.prototype.layoutColumns=function(a,b){for(var i,j,k,m,c=[],d=[],e=0,g=0,h=0;e<this.columns.length;e++){for(c.push(this.outerOffset),j=this.columns[e],m=e*a+b,i=c[e],g=0;g<j.length;g++,h++)k=j[g].data("wookmark-top",i),(d[h]={obj:k,css:{top:i}}).css[this.direction]=m,i+=k.data("wookmark-height")+this.offset;c[e]=i}return f(d),Math.max.apply(Math,c)},b.prototype.clear=function(){clearTimeout(this.resizeTimer),a(window).unbind("resize.wookmark",this.onResize),this.container.unbind("refreshWookmark",this.onRefresh),this.handler.wookmarkInstance=null},b}(),a.fn.wookmark=function(a){return this.wookmarkInstance?this.wookmarkInstance.update(a||{}):this.wookmarkInstance=new b(this,a||{}),this.wookmarkInstance.layout(!0),this.show()}}),jQuery(document).ready(function(a){a(".pinterest-container").each(function(){function i(){f.wookmark({itemWidth:d,autoResize:!0,container:f.parent(),resizeDelay:0,offset:b.data("offset"),outerOffset:b.data("outerOffset"),fillEmptySpace:!0,onLayoutChanged:function(){"link_image"==g&&this.handler.each(function(){a(this).find("a.lightbox-link").removeAttr("rel");try{a.boxer("destroy"),a(this).find("a.lightbox-link").boxer("destroy")}catch(d){}a(this).hasClass("inactive")||a(this).find("a.lightbox-link").attr("rel","gallery-"+c),a(this).find("a.lightbox-link").boxer({minWidth:e,fixed:!0})})}})}var b=a(this),c=b.data("id"),d=b.data("itemwidth"),e=b.data("minwidth"),f=a(this).find("li").css("width",d),g=b.data("onclick"),h="off"==b.data("imagesload")?!0:!1;f.find("img").css("width",d),b.find("li").each(function(){a(this).find("p")[0]&&a(this).css("background",b.data("background"))}),b.find("p").css("color",b.data("color")),h?a(this).imagesLoaded(function(){i()}):i()})});