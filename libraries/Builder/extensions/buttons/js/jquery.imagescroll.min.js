!function(a,b){"function"==typeof define&&define.amd?define(["jquery"],b):b(a.jQuery)}(this,function(a){"use strict";function r(a,b){return typeof a===b}function s(a,b){return!!~(""+a).indexOf(b)}function t(a,b){for(var c in a){var d=a[c];if(!s(d,"-")&&void 0!==h[d])return"pfx"==b?d:!0}return!1}function u(a,b,c){for(var d in a){var e=b[a[d]];if(void 0!==e)return c===!1?a[d]:r(e,"function")?e.bind(c||b):e}return!1}function v(a,b,c){var d=a.charAt(0).toUpperCase()+a.slice(1),e=(a+" "+j.join(d+" ")+d).split(" ");return r(b,"string")||r(b,"undefined")?t(e,b):(e=(a+" "+k.join(d+" ")+d).split(" "),u(e,b,c))}var b,p,c={image:null,imageAttribute:"image",holderClass:"imageHolder",container:a("body"),speed:.2,coverRatio:.75,holderMinHeight:200,extraHeight:0,mediaWidth:600,mediaHeight:900,parallax:!0,touch:!1},d={},e=document.documentElement,f="imageScrollModernizr",g=document.createElement(f),h=g.style,i="Webkit Moz O ms",j=i.split(" "),k=i.toLowerCase().split(" "),l={},m=a(window),n=0,o="",q=function(a,b,c,d){var g,h,i,j,k=document.createElement("div"),l=document.body,m=l||document.createElement("body");if(parseInt(c,10))for(;c--;)i=document.createElement("div"),i.id=d?d[c]:f+(c+1),k.appendChild(i);return g=["&#173;",'<style id="s',f,'">',a,"</style>"].join(""),k.id=f,(l?k:m).innerHTML+=g,m.appendChild(k),l||(m.style.background="",m.style.overflow="hidden",j=e.style.overflow,e.style.overflow="hidden",e.appendChild(m)),h=b(k,a),l?k.parentNode.removeChild(k):(m.parentNode.removeChild(m),e.style.overflow=j),!!h};return l.csstransforms=function(){return!!v("transform")},l.csstransforms3d=function(){var a=!!v("perspective");return a&&"webkitPerspective"in e.style&&q("@media (transform-3d),(-webkit-transform-3d){#imageScrollModernizr{left:9px;position:absolute;height:3px;}}",function(b){a=9===b.offsetLeft&&3===b.offsetHeight}),a},d.prefixed=function(a,b,c){return b?v(a,b,c):v(a,"pfx")},window.requestAnimationFrame=d.prefixed("requestAnimationFrame",window)||function(a){var c=(new Date).getTime(),d=Math.max(0,16-(c-n)),e=window.setTimeout(function(){a(c+d)},d);return n=c+d,e},l.csstransforms3d()?o="csstransforms3d":l.csstransforms()&&(o="csstransforms"),""!==o&&(p=d.prefixed("transform")),b=function(b,d){return{init:function(){if(this.$imageHolder=a(b),this.settings=a.extend({},c,d),this.image=this.$imageHolder.data(this.settings.imageAttribute)||this.settings.image,this.mediaWidth=this.$imageHolder.data("width")||this.settings.mediaWidth,this.mediaHeight=this.$imageHolder.data("height")||this.settings.mediaHeight,this.coverRatio=this.$imageHolder.data("cover-ratio")||this.settings.coverRatio,this.extraHeight=this.$imageHolder.data("extra-height")||this.settings.extraHeight,this.link=this.$imageHolder.data("link"),this.target=this.$imageHolder.data("target"),this.ticking=!1,!this.image)throw new Error("You need to provide either a data-img attr or an image option");this.$scrollingElement=a("<img/>",{src:this.image}),this.settings.touch===!0?(this.$scrollingElement.addClass("cq-parallaxmobileimage").css({maxWidth:"100%"}).prependTo(this.$imageHolder),""!=this.link&&(this.$scrollingElement.data("link",this.link),this.$scrollingElement.data("target",this.target),this.$scrollingElement.on("click",function(){var c=a(this).data("target"),d=a(this).data("link");console.log("_link",d,c),d&&""!=d&&("_blank"==c?window.open(d):window.location=d)}))):this.settings.parallax===!0?(this.$scrollerHolder=a("<div/>",{html:this.$imageHolder.html()}).css({top:0,visibility:"hidden",position:"fixed",overflow:"hidden"}).addClass(this.settings.holderClass).prependTo(this.settings.container),this.$imageHolder.css("visibility","hidden").empty(),this.$scrollingElement.css({position:"absolute",visibility:"hidden",maxWidth:"none"}).prependTo(this.$scrollerHolder),""!=this.link&&(this.$scrollerHolder.data("link",this.link).css("cursor","pointer"),this.$scrollerHolder.data("target",this.target))):(this.$scrollerHolder=this.$imageHolder.css({overflow:"hidden"}),this.$scrollingElement.css({position:"relative",overflow:"hidden"}).prependTo(this.$imageHolder)),this.settings.touch===!1&&(this._adjustImgHolderHeights(),this.settings.parallax===!0?this._updatePositions():this._updateFallbackPositions(),this._bindEvents())},_adjustImgHolderHeights:function(){var d,e,f,g,h,i,j,k,l,a=m.height(),b=m.width()-this.settings.container.offset().left,c=this.coverRatio*a;c=(this.settings.holderMinHeight<c?Math.floor(c):this.settings.holderMinHeight)+this.extraHeight,k=Math.floor(a-(a-c)*this.settings.speed),i=Math.round(this.mediaWidth*(k/this.mediaHeight)),i>=b?j=k:(i=b,j=Math.round(this.mediaHeight*(i/this.mediaWidth))),l=k-c,h=a+c,g=2*a*(1-this.settings.speed)-l,d=-(l/2+(j-k)/2),e=0,f=d-g/2;var n=this.settings.container.width();this.$scrollingElement.css({height:j,width:i}),this.$imageHolder.height(c),this.$scrollerHolder.css({height:c,width:n}),this.scrollingState={winHeight:a,fromY:f,imgTopPos:d,imgLeftPos:e,imgHolderHeight:c,imgScrollingDistance:g,travelDistance:h,holderDistanceFromTop:this.$imageHolder.offset().top-m.scrollTop()}},_bindEvents:function(){var a=this;m.on("resize",function(){a._adjustImgHolderHeights(),a.settings.parallax===!0?a._requestTick():a._updateFallbackPositions()}),this.settings.parallax===!0&&m.on("scroll",function(){a.scrollingState.holderDistanceFromTop=a.$imageHolder.offset().top-m.scrollTop(),a._requestTick()})},_requestTick:function(){var a=this;this.ticking||(this.ticking=!0,requestAnimationFrame(function(){a._updatePositions()}))},_updatePositions:function(){if(this.scrollingState.holderDistanceFromTop<=this.scrollingState.winHeight&&this.scrollingState.holderDistanceFromTop>=-this.scrollingState.imgHolderHeight){var a=this.scrollingState.holderDistanceFromTop+this.scrollingState.imgHolderHeight,b=a/this.scrollingState.travelDistance,c=Math.round(this.scrollingState.fromY+this.scrollingState.imgScrollingDistance*(1-b)),d=this.settings.container.offset().left;this.$scrollerHolder.css(this._getCSSObject({transform:p,left:d,x:Math.ceil(this.scrollingState.imgLeftPos)+(""===o&&d>0?d:0),y:Math.round(this.scrollingState.holderDistanceFromTop),visibility:"visible"})),this.$scrollingElement.css(this._getCSSObject({transform:p,x:0,y:c,visibility:"visible"}))}else this.$scrollerHolder.css({visibility:"hidden"}),this.$scrollingElement.css({visibility:"hidden"});this.ticking=!1},_updateFallbackPositions:function(){this.$scrollerHolder.css({width:"100%"}),this.$scrollingElement.css({top:this.scrollingState.imgTopPos,left:this.scrollingState.imgLeftPos})},_getCSSObject:function(a){return"csstransforms3d"===o?a.transform="translate3d("+a.x+"px, "+a.y+"px, 0)":"csstransforms"===o?a.transform="translate("+a.x+"px, "+a.y+"px)":(a.top=a.y,a.left=a.x),a}}},b.defaults=c,a.fn.imageScroll=function(a){return this.each(function(){new b(this,a).init()})},b});