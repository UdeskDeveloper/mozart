jQuery(function(){var e=jQuery(document),t=jQuery("#widgets-right"),i=function(e,t){var i=jQuery(t).closest(".widget"),n=i.find(".csb-clone-button"),s=i.find(".widget-control-actions .widget-control-save"),a=i.find(".widget-control-actions .spinner"),d=i.find(".widget-control-save");1!=i.data("_csb_cloning")&&(a.insertBefore(s).css({"float":"left"}),n.insertBefore(s).click(o),d.click(r),i.data("_csb_cloning",!0))},n=function(){var e=jQuery(this).closest(".widget"),i=e.find("input.csb-clone-group").val(),n=t.find('input.csb-clone-group[value="'+i+'"]').closest(".widget");isNaN(i)||1>i||(n.addClass("csb-marker"),e.removeClass("csb-marker"))},s=function(){var e=jQuery(".widget.csb-marker");e.removeClass("csb-marker")},a=function(){var e=t.find("input.csb-clone-group");e.each(function(){var e=jQuery(this).val(),i=t.find('input.csb-clone-group[value="'+e+'"]').closest(".widget"),a=i.find(".widget-title h4"),o="add";(isNaN(e)||1>e)&&(o="remove"),i.length<2&&(o="remove"),a.removeClass("csb-group group-active").find(".btn-clone-group").remove(),i.removeAttr("data-csb-icon"),"add"==o&&(a.addClass("csb-group group-active").prepend('<i class="dashicons dashicons-admin-links btn-clone-group"></i> '),a.find(".btn-clone-group").hover(n,s).click(d))})},d=function(e){var t=jQuery(this).closest(".widget"),i=t.find(".widget-title h4"),a=i.find(".btn-clone-group"),d=t.find("input.csb-clone-group");return e.preventDefault(),e.stopPropagation(),i.hasClass("group-active")?(i.removeClass("group-active"),a.removeClass("dashicons-admin-links").addClass("dashicons-editor-unlink"),d.data("group",d.val()),d.val(0),s()):(i.addClass("group-active"),a.addClass("dashicons-admin-links").removeClass("dashicons-editor-unlink"),d.val(d.data("group")),n.call(this,[e])),!1},o=function(e){var t=jQuery(this).closest(".widget"),i=jQuery("#widgets-left"),n=jQuery(".widgets-chooser"),s=jQuery("#wpbody-content");e.preventDefault();var a=t.find("input.csb-clone-state").val();"new"===a&&wpWidgets.save(t,0,0,0),wpWidgets.clearWidgetSelection(),n.slideUp(200,function(){n.hide(),s.append(this)});var d=t.find("input.id_base").val(),o=i.find('input.id_base[value="'+d+'"]'),c=o.closest(".widget");c.addClass("widget-in-question");var r=t.find("input.csb-clone-group").val(),l=(c.find(".widget-control-actions"),c.find("input.csb-clone-group")),u=c.find("input.csb-clone-state");l.val(r),u.val("empty");var g=t.closest(".widgets-sortables"),v=g.attr("id");return n.find(".widgets-chooser-selected").removeClass("widgets-chooser-selected"),n.find("li").each(function(){var e=jQuery(this);v==e.data("sidebarId")&&e.addClass("widgets-chooser-selected").focus()}),wpWidgets.addWidget(n),wpWidgets.clearWidgetSelection(),l.val(0),!1},c=function(e){var t=e.find("input.csb-clone-state");"empty"==t.val()&&(e.addClass("wpmui-loading"),wpWidgets.save(e,0,1,0))},r=function(){var e=jQuery(this).closest(".widget"),i=e.find("input.csb-clone-group").val(),n=t.find('input.csb-clone-group[value="'+i+'"]').closest(".widget").not(e);n.each(function(){{var e=jQuery(this);e.find("input.csb-clone-state")}e.addClass("wpmui-loading").attr("data-reload",!0)})},l=function(){var e=t.find(".widget[data-reload]");e.each(function(){var e=jQuery(this),t=e.find("input.csb-clone-state");t.val("empty"),e.removeAttr("data-reload"),wpWidgets.save(e,0,0,0)})},u=function(e,t,i,n){var s="string"==typeof i.data?i.data:"",d=s.match(/^.*&action=([^&]+).*$/);if(find_widget=s.match(/^.*&widget-id=([^&]+).*$/),action=d&&2==d.length?d[1]:"",widget=find_widget&&2==find_widget.length?find_widget[1]:"",widget.length){var o=jQuery('.widget input.widget-id[value="'+widget+'"]'),r=o.closest(".widget");switch(action){case"save-widget":r.removeClass("wpmui-loading"),n.length?n.match(/^deleted:/)?setTimeout(a,400):(a(),l(r)):c(r)}}};t.find(".widget").each(i),e.on("widget-added",i),e.ajaxSuccess(u),a()});